# ã‚¯ã‚ªãƒªãƒ†ã‚£ã‚¢ãƒƒãƒ— ã‚¹ãƒ†ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰

**ã€ŒåŠç¬¬ç‚¹ã‹ã‚‰ã€æœ¬ç‰©ã®ãƒ´ã‚¡ãƒ³ã‚µãƒç³»ã‚²ãƒ¼ãƒ ã¸ã€**

Step 15 ã¾ã§ã§ã€Œå‹•ãã‚²ãƒ¼ãƒ ã€ã¯å®Œæˆã—ã¾ã—ãŸã€‚ã“ã“ã‹ã‚‰ã¯**ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒæ¥½ã—ã‚ã‚‹ã‚²ãƒ¼ãƒ **ã‚’ç›®æŒ‡ã—ã¾ã™ã€‚

---

## ç¾çŠ¶ã®æ•´ç†ï¼ˆStep 15 å®Œäº†æ™‚ç‚¹ï¼‰

| æ©Ÿèƒ½ | çŠ¶æ…‹ |
|---|---|
| ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç§»å‹• | âœ… WASD / çŸ¢å°ã‚­ãƒ¼ |
| æ•µã‚¹ãƒãƒ¼ãƒ³ï¼ˆã‚¦ã‚§ãƒ¼ãƒ–åˆ¶ï¼‰ | âœ… æœ€å¤§ 10,000 ä½“ |
| æ­¦å™¨ 3 ç¨®ï¼ˆMagicWand / Axe / Crossï¼‰ | âœ… |
| ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ãƒ»æ­¦å™¨é¸æŠ | âœ… |
| HP ãƒãƒ¼ãƒ»ã‚¹ã‚³ã‚¢ãƒ»ã‚¿ã‚¤ãƒãƒ¼ HUD | âœ… |
| ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ãƒ»ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ | âœ… |
| 60 FPS å®‰å®šå‹•ä½œ | âœ… |

**ä¸è¶³ã—ã¦ã„ã‚‹ã‚‚ã®ï¼ˆã‚¯ã‚ªãƒªãƒ†ã‚£ã®å£ï¼‰:**

- æ•µãŒå…¨å“¡åŒã˜è¦‹ãŸç›®ãƒ»åŒã˜å‹•ã â†’ å˜èª¿
- æ­¦å™¨ãŒå¼±ãã€æˆé•·å®Ÿæ„ŸãŒãªã„ â†’ ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ãŒç©ºè™š
- è¦–è¦šãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãŒãªã„ â†’ ãƒ’ãƒƒãƒˆæ„ŸãŒãªã„
- BGMãƒ»SE ãŒãªã„ â†’ æ²¡å…¥æ„ŸãŒãªã„
- ã‚«ãƒ¡ãƒ©ãŒå›ºå®š â†’ ãƒãƒƒãƒ—ãŒç‹­ãæ„Ÿã˜ã‚‹
- ã‚¢ã‚¤ãƒ†ãƒ ãƒ‰ãƒ­ãƒƒãƒ—ãŒãªã„ â†’ æˆ¦ç•¥æ€§ãŒãªã„

---

## ã‚¯ã‚ªãƒªãƒ†ã‚£ã‚¢ãƒƒãƒ— ã‚¹ãƒ†ãƒƒãƒ—ä¸€è¦§

```
Step 16: ãƒ’ãƒƒãƒˆã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼ˆãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ï¼‰
Step 17: æ­¦å™¨ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼ˆåŒã˜æ­¦å™¨ã‚’é‡ã­ã‚‹ã¨å¼·åŒ–ï¼‰
Step 18: è¤‡æ•°ã®æ•µã‚¿ã‚¤ãƒ—ï¼ˆé€Ÿã„ãƒ»ç¡¬ã„ãƒ»å¤§ãã„ï¼‰
Step 19: ã‚¢ã‚¤ãƒ†ãƒ ãƒ‰ãƒ­ãƒƒãƒ—ï¼ˆå›å¾©ãƒ»ç£çŸ³ãƒ»çˆ†å¼¾ï¼‰
Step 20: ã‚«ãƒ¡ãƒ©ã‚·ã‚¹ãƒ†ãƒ ï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è¿½å¾“ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼‰
Step 21: æ­¦å™¨ã®è¿½åŠ ï¼ˆWhip / Fireball / Lightningï¼‰
Step 22: BGMãƒ»SEï¼ˆrodio ã‚¯ãƒ¬ãƒ¼ãƒˆï¼‰
Step 23: ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒ•ãƒ¬ãƒ¼ãƒ åˆ‡ã‚Šæ›¿ãˆï¼‰
Step 24: ãƒœã‚¹ã‚¨ãƒãƒŸãƒ¼ï¼ˆå®šæœŸå‡ºç¾ãƒ»ç‰¹æ®Šè¡Œå‹•ï¼‰
Step 25: ã‚²ãƒ¼ãƒ ãƒãƒ©ãƒ³ã‚¹èª¿æ•´ãƒ»ãƒãƒªãƒƒã‚·ãƒ¥
```

---

## Step 16: ãƒ’ãƒƒãƒˆã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼ˆãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ï¼‰

### ç›®æ¨™
æ•µãŒå¼¾ä¸¸ã«å½“ãŸã£ãŸã¨ãã€æ­»ã‚“ã ã¨ãã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’å—ã‘ãŸã¨ãã«**è¦–è¦šãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯**ã‚’è¿½åŠ ã™ã‚‹ã€‚

### ãªãœé‡è¦ã‹
ãƒ’ãƒƒãƒˆæ„Ÿã¯ã‚²ãƒ¼ãƒ ã®ã€Œæ°—æŒã¡ã‚ˆã•ã€ã®æ ¹å¹¹ã€‚ã“ã‚ŒãŒãªã„ã¨ã©ã‚Œã ã‘æ•µã‚’å€’ã—ã¦ã‚‚é”æˆæ„ŸãŒãªã„ã€‚

### å®Ÿè£…å†…å®¹

#### Rust å´: ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ« SoA ã‚’è¿½åŠ 

```rust
// native/game_native/src/lib.rs ã«è¿½åŠ 

pub struct ParticleWorld {
    pub positions_x:  Vec<f32>,
    pub positions_y:  Vec<f32>,
    pub velocities_x: Vec<f32>,
    pub velocities_y: Vec<f32>,
    pub lifetime:     Vec<f32>,   // æ®‹ã‚Šå¯¿å‘½ï¼ˆç§’ï¼‰
    pub max_lifetime: Vec<f32>,   // åˆæœŸå¯¿å‘½ï¼ˆãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆè¨ˆç®—ç”¨ï¼‰
    pub color:        Vec<[f32; 4]>, // RGBA
    pub size:         Vec<f32>,   // ãƒ”ã‚¯ã‚»ãƒ«ã‚µã‚¤ã‚º
    pub alive:        Vec<bool>,
    pub count:        usize,
}

impl ParticleWorld {
    pub fn emit(&mut self, x: f32, y: f32, count: usize, color: [f32; 4], rng: &mut SimpleRng) {
        for _ in 0..count {
            let angle = rng.next_f32() * std::f32::consts::TAU;
            let speed = 50.0 + rng.next_f32() * 150.0;
            let vx = angle.cos() * speed;
            let vy = angle.sin() * speed;
            let lifetime = 0.3 + rng.next_f32() * 0.4;
            self.spawn(x, y, vx, vy, lifetime, color, 4.0 + rng.next_f32() * 4.0);
        }
    }
}
```

#### ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã®æ›´æ–°ï¼ˆphysics_step å†…ï¼‰

```rust
// ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«æ›´æ–°: ç§»å‹• + ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ
for i in 0..w.particles.len() {
    if !w.particles.alive[i] { continue; }
    w.particles.positions_x[i] += w.particles.velocities_x[i] * dt;
    w.particles.positions_y[i] += w.particles.velocities_y[i] * dt;
    // é‡åŠ›åŠ¹æœ
    w.particles.velocities_y[i] += 200.0 * dt;
    w.particles.lifetime[i] -= dt;
    if w.particles.lifetime[i] <= 0.0 {
        w.particles.kill(i);
    }
}
```

#### ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼å´: ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚’æç”»

```rust
// renderer/mod.rs: get_render_data ã®æˆ»ã‚Šå€¤ã«ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚’è¿½åŠ 
// color_tint ã® alpha ã‚’ lifetime/max_lifetime ã§ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ
let alpha = p.lifetime[i] / p.max_lifetime[i];
instances.push(SpriteInstance {
    position:   [px - p.size[i]/2.0, py - p.size[i]/2.0],
    size:       [p.size[i], p.size[i]],
    uv_offset:  particle_uv().0,
    uv_size:    particle_uv().1,
    color_tint: [r, g, b, alpha],  // â† ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ
});
```

### ã‚¢ãƒˆãƒ©ã‚¹æ›´æ–°

```python
# assets/sprites/gen_atlas.py
# ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ç”¨ã®ç™½ã„å††ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆã‚’è¿½åŠ ï¼ˆ192ã€œ255 px åˆ—ï¼‰
```

### ç¢ºèªãƒã‚¤ãƒ³ãƒˆ
- [ ] æ•µãŒæ­»ã¬ã¨ã‚ªãƒ¬ãƒ³ã‚¸è‰²ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ãŒé£›ã³æ•£ã‚‹
- [ ] ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’å—ã‘ã‚‹ã¨èµ¤ã„ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ãŒå‡ºã‚‹
- [ ] ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ãŒè‡ªç„¶ã«ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆã™ã‚‹
- [ ] 10,000 ä½“ + ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ« 1,000 å€‹ã§ã‚‚ 60 FPS ã‚’ç¶­æŒ

---

## Step 17: æ­¦å™¨ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼ˆåŒã˜æ­¦å™¨ã‚’é‡ã­ã‚‹ã¨å¼·åŒ–ï¼‰

### ç›®æ¨™
ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—æ™‚ã«**ã™ã§ã«æŒã£ã¦ã„ã‚‹æ­¦å™¨ã‚’é¸ã¶ã¨å¼·åŒ–**ã•ã‚Œã‚‹ã€‚ãƒ´ã‚¡ãƒ³ã‚µãƒã®æ ¸å¿ƒã‚·ã‚¹ãƒ†ãƒ ã€‚

### ãªãœé‡è¦ã‹
ã€Œã“ã®æ­¦å™¨ã‚’ãƒ¬ãƒ™ãƒ« MAX ã«ã—ãŸã„ã€ã¨ã„ã†ç›®æ¨™ãŒã‚²ãƒ¼ãƒ ã®ç¸¦è»¸ã«ãªã‚‹ã€‚

### å®Ÿè£…å†…å®¹

#### Rust å´: WeaponSlot ã«ãƒ¬ãƒ™ãƒ«ã‚’è¿½åŠ 

```rust
pub struct WeaponSlot {
    pub kind:           WeaponKind,
    pub level:          u32,      // 1ã€œ8
    pub cooldown_timer: f32,
}

impl WeaponSlot {
    /// ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ãŸã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ï¼ˆãƒ¬ãƒ™ãƒ«ãŒä¸ŠãŒã‚‹ã»ã©é€Ÿãæ’ƒã¦ã‚‹ï¼‰
    pub fn effective_cooldown(&self) -> f32 {
        let base = self.kind.cooldown();
        // ãƒ¬ãƒ™ãƒ« 1 ãŒåŸºæº–ã€ãƒ¬ãƒ™ãƒ« 8 ã§ 50% çŸ­ç¸®
        base * (1.0 - (self.level as f32 - 1.0) * 0.07).max(0.5)
    }

    /// ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ãŸãƒ€ãƒ¡ãƒ¼ã‚¸ï¼ˆãƒ¬ãƒ™ãƒ«ãŒä¸ŠãŒã‚‹ã»ã©å¼·ã„ï¼‰
    pub fn effective_damage(&self) -> i32 {
        let base = self.kind.damage();
        base + (self.level as i32 - 1) * (base / 4).max(1)
    }

    /// ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ãŸå¼¾ä¸¸æ•°ï¼ˆMagicWand: Lv3 ã§ 2 ç™ºã€Lv5 ã§ 3 ç™ºï¼‰
    pub fn bullet_count(&self) -> usize {
        match self.kind {
            WeaponKind::MagicWand => match self.level {
                1..=2 => 1,
                3..=4 => 2,
                5..=6 => 3,
                _     => 4,
            },
            WeaponKind::Cross => match self.level {
                1..=3 => 4,  // ä¸Šä¸‹å·¦å³
                4..=6 => 8,  // æ–œã‚è¿½åŠ 
                _     => 8,
            },
            _ => 1,
        }
    }
}
```

#### add_weapon NIF ã®æ›´æ–°

```rust
// åŒã˜æ­¦å™¨ã‚’é¸ã‚“ã å ´åˆã¯ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—
if let Some(slot) = w.weapon_slots.iter_mut().find(|s| s.kind == kind) {
    slot.level = (slot.level + 1).min(8);
} else if w.weapon_slots.len() < MAX_SLOTS {
    w.weapon_slots.push(WeaponSlot::new(kind));
}
```

#### Elixir å´: LevelSystem ã®æ›´æ–°

```elixir
# lib/game/systems/level_system.ex
# ã™ã§ã«æŒã£ã¦ã„ã‚‹æ­¦å™¨ã¯ã€ŒLv.X â†’ Lv.X+1ã€ã¨ã—ã¦è¡¨ç¤º
def generate_weapon_choices(current_weapons, weapon_levels) do
  all_weapons = [:magic_wand, :axe, :cross]
  # æœªæ‰€æŒã‚’å„ªå…ˆã€æ¬¡ã«ä½ãƒ¬ãƒ™ãƒ«æ­¦å™¨ã‚’å„ªå…ˆ
  all_weapons
  |> Enum.sort_by(fn w ->
    lv = Map.get(weapon_levels, w, 0)
    if lv == 0, do: -1, else: lv  # æœªæ‰€æŒã‚’æœ€å„ªå…ˆ
  end)
  |> Enum.take(3)
end
```

#### HUD: æ­¦å™¨ãƒ¬ãƒ™ãƒ«è¡¨ç¤º

```
[ğŸ”® Magic Wand Lv.3]  [ğŸª“ Axe Lv.1]  [âœ Cross Lv.2]
```

### ç¢ºèªãƒã‚¤ãƒ³ãƒˆ
- [ ] åŒã˜æ­¦å™¨ã‚’é¸ã¶ã¨ãƒ¬ãƒ™ãƒ«ãŒä¸ŠãŒã‚‹
- [ ] ãƒ¬ãƒ™ãƒ«ãŒä¸ŠãŒã‚‹ã¨å¼¾ãŒé€Ÿã/å¼·ããªã‚‹
- [ ] MagicWand Lv.3 ã§ 2 ç™ºåŒæ™‚ç™ºå°„ã•ã‚Œã‚‹
- [ ] HUD ã«æ­¦å™¨ãƒ¬ãƒ™ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹

---

## Step 18: è¤‡æ•°ã®æ•µã‚¿ã‚¤ãƒ—

### ç›®æ¨™
**3 ç¨®é¡ã®æ•µ**ã‚’è¿½åŠ ã—ã¦æˆ¦ç•¥çš„å¤šæ§˜æ€§ã‚’ç”Ÿã‚€ã€‚

| æ•µã‚¿ã‚¤ãƒ— | è¦‹ãŸç›® | HP | é€Ÿåº¦ | ã‚µã‚¤ã‚º | çµŒé¨“å€¤ | ç‰¹å¾´ |
|---|---|---|---|---|---|---|
| Slimeï¼ˆã‚¹ãƒ©ã‚¤ãƒ ï¼‰ | ç·‘ | 30 | 80 | 40px | 5 | åŸºæœ¬æ•µï¼ˆç¾åœ¨ã®æ•µï¼‰ |
| Batï¼ˆã‚³ã‚¦ãƒ¢ãƒªï¼‰ | ç´« | 15 | 160 | 24px | 3 | é€Ÿã„ãŒå¼±ã„ |
| Golemï¼ˆã‚´ãƒ¼ãƒ¬ãƒ ï¼‰ | ç° | 150 | 40 | 64px | 20 | é…ã„ãŒç¡¬ã„ |

### å®Ÿè£…å†…å®¹

#### Rust å´: EnemyKind ã‚’è¿½åŠ 

```rust
#[derive(Clone, Copy, PartialEq, Debug)]
#[repr(u8)]
pub enum EnemyKind {
    Slime = 0,
    Bat   = 1,
    Golem = 2,
}

impl EnemyKind {
    pub fn max_hp(&self) -> f32 {
        match self { Self::Slime => 30.0, Self::Bat => 15.0, Self::Golem => 150.0 }
    }
    pub fn speed(&self) -> f32 {
        match self { Self::Slime => 80.0, Self::Bat => 160.0, Self::Golem => 40.0 }
    }
    pub fn radius(&self) -> f32 {
        match self { Self::Slime => 20.0, Self::Bat => 12.0, Self::Golem => 32.0 }
    }
    pub fn exp_reward(&self) -> u32 {
        match self { Self::Slime => 5, Self::Bat => 3, Self::Golem => 20 }
    }
    pub fn damage_per_sec(&self) -> f32 {
        match self { Self::Slime => 20.0, Self::Bat => 10.0, Self::Golem => 40.0 }
    }
}
```

#### EnemyWorld SoA ã« kind ã‚’è¿½åŠ 

```rust
pub struct EnemyWorld {
    // ... æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ ...
    pub kinds: Vec<EnemyKind>,  // è¿½åŠ 
}
```

#### ã‚¢ãƒˆãƒ©ã‚¹æ›´æ–°

```
[0..63]    ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆç·‘ã®é¨å£«ï¼‰
[64..127]  Slimeï¼ˆç·‘ã®ã‚¹ãƒ©ã‚¤ãƒ ï¼‰
[128..191] Batï¼ˆç´«ã®ã‚³ã‚¦ãƒ¢ãƒªï¼‰
[192..255] Golemï¼ˆç°è‰²ã®ã‚´ãƒ¼ãƒ¬ãƒ ï¼‰
[256..319] å¼¾ä¸¸ï¼ˆç™½ã„å…‰çƒï¼‰
[320..383] ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ï¼ˆç™½ã„å††ï¼‰
```

#### Elixir å´: SpawnSystem ã®æ›´æ–°

```elixir
# lib/game/systems/spawn_system.ex
# ã‚¦ã‚§ãƒ¼ãƒ–é€²è¡Œã«å¿œã˜ã¦æ•µã‚¿ã‚¤ãƒ—ã‚’å¤‰ãˆã‚‹
def enemy_kind_for_wave(elapsed_s) do
  cond do
    elapsed_s < 30  -> :slime              # åºç›¤: ã‚¹ãƒ©ã‚¤ãƒ ã®ã¿
    elapsed_s < 60  -> Enum.random([:slime, :bat])
    elapsed_s < 120 -> Enum.random([:slime, :bat, :golem])
    true            -> Enum.random([:slime, :bat, :golem])
  end
end
```

### ç¢ºèªãƒã‚¤ãƒ³ãƒˆ
- [ ] 30 ç§’å¾Œã«ã‚³ã‚¦ãƒ¢ãƒªãŒå‡ºç¾ã™ã‚‹
- [ ] 60 ç§’å¾Œã«ã‚´ãƒ¼ãƒ¬ãƒ ãŒå‡ºç¾ã™ã‚‹
- [ ] ã‚´ãƒ¼ãƒ¬ãƒ ã¯è¤‡æ•°ç™ºå½“ã¦ãªã„ã¨å€’ã›ãªã„
- [ ] å„æ•µã‚¿ã‚¤ãƒ—ãŒç•°ãªã‚‹ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆã§æç”»ã•ã‚Œã‚‹

---

## Step 19: ã‚¢ã‚¤ãƒ†ãƒ ãƒ‰ãƒ­ãƒƒãƒ—

### ç›®æ¨™
æ•µã‚’å€’ã™ã¨**ã‚¢ã‚¤ãƒ†ãƒ ãŒè½ã¡ã‚‹**ã€‚ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒè¿‘ã¥ãã¨è‡ªå‹•åé›†ã€‚

| ã‚¢ã‚¤ãƒ†ãƒ  | ãƒ‰ãƒ­ãƒƒãƒ—ç‡ | åŠ¹æœ |
|---|---|---|
| çµŒé¨“å€¤å®çŸ³ï¼ˆç·‘ï¼‰ | 100% | EXP +5ã€œ20ï¼ˆæ•µã‚¿ã‚¤ãƒ—ã«ã‚ˆã‚‹ï¼‰ |
| å›å¾©ãƒãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆèµ¤ï¼‰ | 5% | HP +20 |
| ç£çŸ³ï¼ˆé»„ï¼‰ | 2% | 10 ç§’é–“ã€ç”»é¢å†…ã®å®çŸ³ã‚’è‡ªå‹•åé›† |

### å®Ÿè£…å†…å®¹

#### Rust å´: ItemWorld SoA

```rust
#[derive(Clone, Copy, PartialEq)]
pub enum ItemKind { Gem, Potion, Magnet }

pub struct ItemWorld {
    pub positions_x: Vec<f32>,
    pub positions_y: Vec<f32>,
    pub kinds:       Vec<ItemKind>,
    pub value:       Vec<u32>,   // Gem: EXP é‡, Potion: å›å¾©é‡
    pub alive:       Vec<bool>,
    pub count:       usize,
}
```

#### ç£çŸ³ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ

```rust
// ç£çŸ³ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ä¸­ã¯å®çŸ³ãŒãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«å‘ã‹ã£ã¦é£›ã‚“ã§ãã‚‹
if w.magnet_timer > 0.0 {
    for i in 0..w.items.len() {
        if w.items.alive[i] && w.items.kinds[i] == ItemKind::Gem {
            let dx = px - w.items.positions_x[i];
            let dy = py - w.items.positions_y[i];
            let dist = (dx*dx + dy*dy).sqrt().max(1.0);
            w.items.positions_x[i] += (dx/dist) * 300.0 * dt;
            w.items.positions_y[i] += (dy/dist) * 300.0 * dt;
        }
    }
    w.magnet_timer -= dt;
}
```

#### è‡ªå‹•åé›†åˆ¤å®š

```rust
// ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®åé›†åŠå¾„ï¼ˆé€šå¸¸ 60pxã€ç£çŸ³ä¸­ã¯å…¨ç”»é¢ï¼‰
let collect_r = if w.magnet_timer > 0.0 { 9999.0 } else { 60.0 };
```

### ç¢ºèªãƒã‚¤ãƒ³ãƒˆ
- [ ] æ•µã‚’å€’ã™ã¨å®çŸ³ãŒè½ã¡ã‚‹
- [ ] å®çŸ³ã«è¿‘ã¥ãã¨è‡ªå‹•åé›†ã•ã‚Œã‚‹
- [ ] ç£çŸ³ã‚’å–ã‚‹ã¨ç”»é¢ä¸­ã®å®çŸ³ãŒé›†ã¾ã£ã¦ãã‚‹
- [ ] å›å¾©ãƒãƒ¼ã‚·ãƒ§ãƒ³ã§ HP ãŒå›å¾©ã™ã‚‹

---

## Step 20: ã‚«ãƒ¡ãƒ©ã‚·ã‚¹ãƒ†ãƒ ï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è¿½å¾“ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼‰

### ç›®æ¨™
ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒç”»é¢ä¸­å¤®ã«æ¥ã‚‹ã‚ˆã†ã«ã‚«ãƒ¡ãƒ©ãŒè¿½å¾“ã™ã‚‹ã€‚ãƒãƒƒãƒ—ã‚’åºƒãã—ã¦æ¢ç´¢æ„Ÿã‚’å‡ºã™ã€‚

### ãªãœé‡è¦ã‹
å›ºå®šç”»é¢ã§ã¯ã€Œé€ƒã’å ´ãŒãªã„ã€æ„ŸãŒå¼·ã™ãã‚‹ã€‚ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã«ã‚ˆã‚Šæˆ¦ç•¥çš„ãªç«‹ã¡å›ã‚ŠãŒå¯èƒ½ã«ãªã‚‹ã€‚

### å®Ÿè£…å†…å®¹

#### Rust å´: ã‚«ãƒ¡ãƒ© Uniform ã‚’è¿½åŠ 

```rust
#[repr(C)]
#[derive(Copy, Clone, bytemuck::Pod, bytemuck::Zeroable)]
struct CameraUniform {
    offset: [f32; 2],  // ã‚«ãƒ¡ãƒ©ã®ãƒ¯ãƒ¼ãƒ«ãƒ‰åº§æ¨™ã‚ªãƒ•ã‚»ãƒƒãƒˆ
    _pad:   [f32; 2],
}
```

#### WGSL ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã®æ›´æ–°

```wgsl
// camera offset ã‚’å¼•ã„ã¦ã‚¹ã‚¯ãƒªãƒ¼ãƒ³åº§æ¨™ã«å¤‰æ›
let world_pos = instance.position - camera.offset;
let screen_pos = (world_pos / screen.half_size) * vec2(1.0, -1.0) - vec2(1.0, -1.0);
```

#### ã‚«ãƒ¡ãƒ©ã®æ»‘ã‚‰ã‹ãªè¿½å¾“ï¼ˆlerpï¼‰

```rust
// ã‚«ãƒ¡ãƒ©ã¯å³åº§ã«ã§ã¯ãªãã€æ»‘ã‚‰ã‹ã«ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¿½ã†
let target_x = player_x - SCREEN_WIDTH  / 2.0;
let target_y = player_y - SCREEN_HEIGHT / 2.0;
let lerp_speed = 5.0;
camera.x += (target_x - camera.x) * lerp_speed * dt;
camera.y += (target_y - camera.y) * lerp_speed * dt;
```

#### ãƒãƒƒãƒ—ã‚µã‚¤ã‚ºã®æ‹¡å¤§

```rust
// constants.rs
pub const MAP_WIDTH:  f32 = 4096.0;
pub const MAP_HEIGHT: f32 = 4096.0;
// ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç§»å‹•ç¯„å›²ã‚’ãƒãƒƒãƒ—å†…ã«åˆ¶é™
```

#### èƒŒæ™¯ã‚¿ã‚¤ãƒ«æç”»

```rust
// ã‚«ãƒ¡ãƒ©ä½ç½®ã«å¿œã˜ã¦ã‚¿ã‚¤ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚·ãƒ³ã‚°ã§æç”»
// è‰åœ°ã‚¿ã‚¤ãƒ«ã‚’ 64x64 px ã‚°ãƒªãƒƒãƒ‰ã§æ•·ãè©°ã‚ã‚‹
```

### ç¢ºèªãƒã‚¤ãƒ³ãƒˆ
- [ ] ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒç”»é¢ä¸­å¤®ã«å¸¸ã«è¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ã‚«ãƒ¡ãƒ©ãŒæ»‘ã‚‰ã‹ã«è¿½å¾“ã™ã‚‹
- [ ] ãƒãƒƒãƒ—ç«¯ã§ã‚«ãƒ¡ãƒ©ãŒæ­¢ã¾ã‚‹
- [ ] èƒŒæ™¯ã‚¿ã‚¤ãƒ«ãŒæ­£ã—ãã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã™ã‚‹

---

## Step 21: æ­¦å™¨ã®è¿½åŠ ï¼ˆWhip / Fireball / Lightningï¼‰

### ç›®æ¨™
æ­¦å™¨ã‚’ 6 ç¨®é¡ã«å¢—ã‚„ã—ã€ãƒ—ãƒ¬ã‚¤ã‚¹ã‚¿ã‚¤ãƒ«ã®å¤šæ§˜æ€§ã‚’ç”Ÿã‚€ã€‚

| æ­¦å™¨ | å‹•ä½œ | ç‰¹å¾´ |
|---|---|---|
| Magic Wand | æœ€è¿‘æ¥æ•µã«è‡ªå‹•ç…§æº– | åŸºæœ¬æ­¦å™¨ï¼ˆæ—¢å­˜ï¼‰ |
| Axe | æ”¾ç‰©ç·šã‚’æã„ã¦é£›ã¶ | é«˜ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼ˆæ—¢å­˜ï¼‰ |
| Cross | ä¸Šä¸‹å·¦å³ 4 æ–¹å‘ | ç¯„å›²æ”»æ’ƒï¼ˆæ—¢å­˜ï¼‰ |
| **Whip** | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å‘¨å›²ã‚’è–™ãæ‰•ã† | è¿‘è·é›¢ãƒ»æ‰‡çŠ¶ç¯„å›² |
| **Fireball** | æ•µã‚’è²«é€šã™ã‚‹ç‚å¼¾ | è²«é€šãƒ»è¤‡æ•°ãƒ’ãƒƒãƒˆ |
| **Lightning** | æœ€è¿‘æ¥ã‹ã‚‰é€£é–ã™ã‚‹é›»æ’ƒ | ãƒã‚§ãƒ¼ãƒ³ãƒ»æœ€å¤§ 5 ä½“ |

### Whip ã®å®Ÿè£…

```rust
WeaponKind::Whip => {
    // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç§»å‹•æ–¹å‘ã«æ‰‡çŠ¶ã®åˆ¤å®šã‚’å‡ºã™
    let whip_range = 120.0 + (slot.level as f32 - 1.0) * 20.0;
    let whip_angle = std::f32::consts::PI * 0.6; // 108åº¦
    // æ‰‡å½¢å†…ã®æ•µã«ç›´æ¥ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼ˆå¼¾ä¸¸ã‚’ç”Ÿæˆã—ãªã„ï¼‰
    for ei in 0..w.enemies.len() {
        if !w.enemies.alive[ei] { continue; }
        let dx = w.enemies.positions_x[ei] - px;
        let dy = w.enemies.positions_y[ei] - py;
        let dist = (dx*dx + dy*dy).sqrt();
        if dist > whip_range { continue; }
        let angle = dy.atan2(dx);
        let diff = (angle - facing_angle).abs();
        if diff < whip_angle / 2.0 {
            w.enemies.hp[ei] -= dmg as f32;
            // ãƒ’ãƒƒãƒˆã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
        }
    }
}
```

### Lightning ã®ãƒã‚§ãƒ¼ãƒ³å®Ÿè£…

```rust
WeaponKind::Lightning => {
    // æœ€è¿‘æ¥æ•µã‹ã‚‰å§‹ã¾ã‚Šã€æœ€å¤§ chain_count ä½“ã«é€£é–
    let chain_count = 2 + slot.level as usize / 2; // Lv1: 2ä½“, Lv8: 6ä½“
    let mut hit_set = std::collections::HashSet::new();
    let mut current = find_nearest_enemy(&w.enemies, px, py);
    for _ in 0..chain_count {
        if let Some(ei) = current {
            w.enemies.hp[ei] -= dmg as f32;
            hit_set.insert(ei);
            // æ¬¡ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ: ei ã‹ã‚‰æœ€ã‚‚è¿‘ã„æœªãƒ’ãƒƒãƒˆæ•µ
            current = find_nearest_enemy_excluding(&w.enemies, 
                w.enemies.positions_x[ei], w.enemies.positions_y[ei], &hit_set);
        }
    }
}
```

### Elixir å´ã®æ›´æ–°

```elixir
# lib/game/systems/level_system.ex
@all_weapons [:magic_wand, :axe, :cross, :whip, :fireball, :lightning]
```

### ç¢ºèªãƒã‚¤ãƒ³ãƒˆ
- [ ] Whip ãŒæ‰‡çŠ¶ã«æ•µã‚’è–™ãæ‰•ã†
- [ ] Fireball ãŒæ•µã‚’è²«é€šã™ã‚‹
- [ ] Lightning ãŒæœ€å¤§ 5 ä½“ã«é€£é–ã™ã‚‹
- [ ] å„æ­¦å™¨ã®ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—åŠ¹æœãŒæ©Ÿèƒ½ã™ã‚‹

---

## Step 22: BGMãƒ»SEï¼ˆrodio ã‚¯ãƒ¬ãƒ¼ãƒˆï¼‰

### ç›®æ¨™
**éŸ³éŸ¿åŠ¹æœ**ã‚’è¿½åŠ ã—ã¦æ²¡å…¥æ„Ÿã‚’é«˜ã‚ã‚‹ã€‚

### å¿…è¦ãªéŸ³æº
| éŸ³æº | å½¢å¼ | ç”¨é€” |
|---|---|---|
| bgm.ogg | OGG Vorbis | ãƒ«ãƒ¼ãƒ— BGM |
| hit.wav | WAV | æ•µãƒ’ãƒƒãƒˆéŸ³ |
| death.wav | WAV | æ•µæ’ƒç ´éŸ³ |
| level_up.wav | WAV | ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—éŸ³ |
| player_hurt.wav | WAV | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ€ãƒ¡ãƒ¼ã‚¸éŸ³ |
| item_pickup.wav | WAV | ã‚¢ã‚¤ãƒ†ãƒ åé›†éŸ³ |

### Cargo.toml ã¸ã®è¿½åŠ 

```toml
[dependencies]
rodio = "0.20"
```

### å®Ÿè£…

```rust
// audio.rs
use rodio::{Decoder, OutputStream, OutputStreamHandle, Sink, Source};

pub struct AudioManager {
    _stream:       OutputStream,
    stream_handle: OutputStreamHandle,
    bgm_sink:      Sink,
}

impl AudioManager {
    pub fn new() -> Self {
        let (_stream, stream_handle) = OutputStream::try_default().unwrap();
        let bgm_sink = Sink::try_new(&stream_handle).unwrap();
        Self { _stream, stream_handle, bgm_sink }
    }

    pub fn play_bgm(&self, bytes: &'static [u8]) {
        let cursor = std::io::Cursor::new(bytes);
        let source = Decoder::new(cursor).unwrap().repeat_infinite();
        self.bgm_sink.append(source);
    }

    pub fn play_se(&self, bytes: &'static [u8]) {
        let cursor = std::io::Cursor::new(bytes);
        let source = Decoder::new(cursor).unwrap();
        let sink = Sink::try_new(&self.stream_handle).unwrap();
        sink.append(source);
        sink.detach(); // å†ç”Ÿå¾Œã«è‡ªå‹•è§£æ”¾
    }
}
```

### éŸ³æºã®åŸ‹ã‚è¾¼ã¿

```rust
// main.rs
static BGM_BYTES:         &[u8] = include_bytes!("../../../assets/audio/bgm.ogg");
static HIT_BYTES:         &[u8] = include_bytes!("../../../assets/audio/hit.wav");
static LEVEL_UP_BYTES:    &[u8] = include_bytes!("../../../assets/audio/level_up.wav");
```

### ç¢ºèªãƒã‚¤ãƒ³ãƒˆ
- [ ] ã‚²ãƒ¼ãƒ é–‹å§‹ã¨åŒæ™‚ã« BGM ãŒæµã‚Œã‚‹
- [ ] æ•µã‚’å€’ã™ã¨ SE ãŒé³´ã‚‹
- [ ] ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—æ™‚ã« SE ãŒé³´ã‚‹
- [ ] ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’å—ã‘ã‚‹ã¨ SE ãŒé³´ã‚‹

---

## Step 23: ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

### ç›®æ¨™
ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãŒ**ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³**ã™ã‚‹ã€‚é™æ­¢ç”»ã‹ã‚‰ç”Ÿãç”Ÿãã¨ã—ãŸã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã¸ã€‚

### ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»•æ§˜

| ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ | ãƒ•ãƒ¬ãƒ¼ãƒ æ•° | FPS | ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ |
|---|---|---|---|
| ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ | 4 ãƒ•ãƒ¬ãƒ¼ãƒ  | 8 fps | æ­©è¡Œãƒ«ãƒ¼ãƒ— |
| Slime | 4 ãƒ•ãƒ¬ãƒ¼ãƒ  | 6 fps | ãƒã‚¦ãƒ³ã‚¹ãƒ«ãƒ¼ãƒ— |
| Bat | 2 ãƒ•ãƒ¬ãƒ¼ãƒ  | 12 fps | ç¾½ã°ãŸããƒ«ãƒ¼ãƒ— |
| Golem | 2 ãƒ•ãƒ¬ãƒ¼ãƒ  | 4 fps | æ­©è¡Œãƒ«ãƒ¼ãƒ— |

### ã‚¢ãƒˆãƒ©ã‚¹è¨­è¨ˆï¼ˆ256 Ã— 256 px ã«æ‹¡å¼µï¼‰

```
è¡Œ 0 (y=0):   ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ­©è¡Œ 4 ãƒ•ãƒ¬ãƒ¼ãƒ ï¼ˆå„ 64x64ï¼‰
è¡Œ 1 (y=64):  Slime 4 ãƒ•ãƒ¬ãƒ¼ãƒ ï¼ˆå„ 64x64ï¼‰
è¡Œ 2 (y=128): Bat 2 ãƒ•ãƒ¬ãƒ¼ãƒ  + Golem 2 ãƒ•ãƒ¬ãƒ¼ãƒ ï¼ˆå„ 64x64ï¼‰
è¡Œ 3 (y=192): å¼¾ä¸¸ãƒ»ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ãƒ»ã‚¢ã‚¤ãƒ†ãƒ å„ç¨®
```

### Rust å´: ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒãƒ¼

```rust
pub struct EnemyWorld {
    // ... æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ ...
    pub anim_timers: Vec<f32>,   // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒãƒ¼ï¼ˆç§’ï¼‰
    pub anim_frames: Vec<u8>,    // ç¾åœ¨ã®ãƒ•ãƒ¬ãƒ¼ãƒ ç•ªå·
}

// physics_step å†…ã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°
for i in 0..w.enemies.len() {
    if !w.enemies.alive[i] { continue; }
    let fps = w.enemies.kinds[i].anim_fps();
    w.enemies.anim_timers[i] += dt;
    if w.enemies.anim_timers[i] >= 1.0 / fps {
        w.enemies.anim_timers[i] = 0.0;
        let max_frame = w.enemies.kinds[i].frame_count();
        w.enemies.anim_frames[i] = (w.enemies.anim_frames[i] + 1) % max_frame;
    }
}
```

### UV è¨ˆç®—ã®æ›´æ–°

```rust
// æ•µã® UV ã¯ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ãƒ¬ãƒ¼ãƒ ã«å¿œã˜ã¦å¤‰ã‚ã‚‹
let frame = w.enemies.anim_frames[i] as f32;
let (base_u, base_v) = enemy_base_uv(w.enemies.kinds[i]);
let uv_offset = [base_u + frame * (64.0 / ATLAS_W), base_v];
```

### ç¢ºèªãƒã‚¤ãƒ³ãƒˆ
- [ ] ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒæ­©è¡Œã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã™ã‚‹
- [ ] ã‚¹ãƒ©ã‚¤ãƒ ãŒãƒã‚¦ãƒ³ã‚¹ã™ã‚‹
- [ ] ã‚³ã‚¦ãƒ¢ãƒªãŒç¾½ã°ãŸã
- [ ] ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒ 60 FPS ã«å½±éŸ¿ã—ãªã„

---

## Step 24: ãƒœã‚¹ã‚¨ãƒãƒŸãƒ¼

### ç›®æ¨™
**3 åˆ†ã”ã¨ã«ãƒœã‚¹ãŒå‡ºç¾**ã™ã‚‹ã€‚ãƒœã‚¹ã¯ç‰¹æ®Šãªè¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æŒã¤ã€‚

### ãƒœã‚¹ä»•æ§˜

| ãƒœã‚¹ | å‡ºç¾æ™‚é–“ | HP | ç‰¹æ®Šè¡Œå‹• |
|---|---|---|---|
| Slime King | 3 åˆ† | 1000 | å‘¨æœŸçš„ã«å°ã‚¹ãƒ©ã‚¤ãƒ ã‚’ 8 ä½“å¬å–š |
| Bat Lord | 6 åˆ† | 2000 | é«˜é€Ÿçªé€² + ä¸€æ™‚çš„ç„¡æ•µ |
| Stone Golem | 9 åˆ† | 5000 | å²©ã‚’æŠ•ã’ã‚‹ï¼ˆç¯„å›²æ”»æ’ƒï¼‰ |

### Rust å´: BossState

```rust
pub struct BossState {
    pub kind:          BossKind,
    pub x:             f32,
    pub y:             f32,
    pub hp:            f32,
    pub max_hp:        f32,
    pub phase_timer:   f32,  // ç‰¹æ®Šè¡Œå‹•ã®ã‚¿ã‚¤ãƒãƒ¼
    pub invincible:    bool,
    pub alive:         bool,
}

impl BossState {
    pub fn special_action(&mut self, enemies: &mut EnemyWorld, rng: &mut SimpleRng) {
        match self.kind {
            BossKind::SlimeKing => {
                // 8 ä½“ã®ã‚¹ãƒ©ã‚¤ãƒ ã‚’å‘¨å›²ã«ã‚¹ãƒãƒ¼ãƒ³
                for i in 0..8 {
                    let angle = i as f32 * std::f32::consts::TAU / 8.0;
                    let x = self.x + angle.cos() * 100.0;
                    let y = self.y + angle.sin() * 100.0;
                    enemies.spawn_single(x, y, EnemyKind::Slime);
                }
            }
            // ...
        }
    }
}
```

#### Elixir å´: ãƒœã‚¹å‡ºç¾é€šçŸ¥

```elixir
# game_loop.ex: ãƒœã‚¹å‡ºç¾æ™‚ã«ç‰¹åˆ¥ãªé€šçŸ¥
if boss_spawned do
  Logger.warning("[BOSS] #{boss_name} ãŒå‡ºç¾ï¼")
  # HUD ã«ã€ŒBOSS INCOMING!ã€ã‚’è¡¨ç¤º
end
```

### HUD: ãƒœã‚¹ HP ãƒãƒ¼

```rust
// egui ã§ãƒœã‚¹ HP ãƒãƒ¼ã‚’ç”»é¢ä¸Šéƒ¨ã«è¡¨ç¤º
if let Some(boss) = &hud.boss {
    ui.label(format!("ğŸ‘¹ {}", boss.name));
    let ratio = boss.hp / boss.max_hp;
    ui.add(egui::ProgressBar::new(ratio).fill(egui::Color32::DARK_RED));
}
```

### ç¢ºèªãƒã‚¤ãƒ³ãƒˆ
- [ ] 3 åˆ†ã§ãƒœã‚¹ãŒå‡ºç¾ã™ã‚‹
- [ ] ãƒœã‚¹ãŒé€šå¸¸ã®æ•µã‚ˆã‚Šå¤§ããè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ãƒœã‚¹ã® HP ãƒãƒ¼ãŒç”»é¢ä¸Šéƒ¨ã«è¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ãƒœã‚¹ãŒç‰¹æ®Šè¡Œå‹•ã‚’ã™ã‚‹
- [ ] ãƒœã‚¹ã‚’å€’ã™ã¨å¤§é‡ã®çµŒé¨“å€¤ãŒå¾—ã‚‰ã‚Œã‚‹

---

## Step 25: ã‚²ãƒ¼ãƒ ãƒãƒ©ãƒ³ã‚¹èª¿æ•´ãƒ»ãƒãƒªãƒƒã‚·ãƒ¥

### ç›®æ¨™
å…¨è¦ç´ ã‚’çµ±åˆã—ã€**30 åˆ†ãƒ—ãƒ¬ã‚¤ã§ãã‚‹å®Œæˆåº¦**ã«ã™ã‚‹ã€‚

### ãƒãƒ©ãƒ³ã‚¹èª¿æ•´é …ç›®

#### é›£æ˜“åº¦ã‚«ãƒ¼ãƒ–

```
0ã€œ1 åˆ†:   ã‚¹ãƒ©ã‚¤ãƒ ã®ã¿ã€ã‚†ã£ãã‚Šã‚¹ãƒãƒ¼ãƒ³ â†’ ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«æ„Ÿ
1ã€œ3 åˆ†:   ã‚³ã‚¦ãƒ¢ãƒªè¿½åŠ ã€ã‚¹ãƒãƒ¼ãƒ³åŠ é€Ÿ â†’ ç·Šå¼µæ„Ÿã®å§‹ã¾ã‚Š
3ã€œ6 åˆ†:   ã‚´ãƒ¼ãƒ¬ãƒ è¿½åŠ ã€ãƒœã‚¹ 1 ä½“ç›® â†’ æœ€åˆã®å±±å ´
6ã€œ10 åˆ†:  å…¨æ•µã‚¿ã‚¤ãƒ—æ··åœ¨ã€é«˜å¯†åº¦ â†’ æœ¬ç•ª
10 åˆ†ã€œ:   ã‚¨ãƒªãƒ¼ãƒˆæ•µï¼ˆHP 3 å€ï¼‰è¿½åŠ  â†’ çµ‚ç›¤ã®ç·Šå¼µæ„Ÿ
```

#### æ­¦å™¨ãƒãƒ©ãƒ³ã‚¹è¡¨

| æ­¦å™¨ | Lv.1 DPS | Lv.8 DPS | å½¹å‰² |
|---|---|---|---|
| Magic Wand | 10/s | 60/s | æ±ç”¨ãƒ»åˆå¿ƒè€…å‘ã‘ |
| Axe | 25/2s | 80/1s | é«˜ç«åŠ›ãƒ»ç„äººå‘ã‘ |
| Cross | 15Ã—4/2s | 30Ã—8/1s | ç¯„å›²ãƒ»ç¾¤ã‚Œå¯¾ç­– |
| Whip | 30/1s | 90/0.5s | è¿‘è·é›¢ãƒ»å£éš›å‘ã‘ |
| Fireball | 20/1s | 70/0.6s | è²«é€šãƒ»åˆ—å‡¦ç† |
| Lightning | 15Ã—3/1s | 40Ã—6/0.5s | ãƒã‚§ãƒ¼ãƒ³ãƒ»æ•£é–‹å¯¾ç­– |

#### ãƒãƒªãƒƒã‚·ãƒ¥é …ç›®

- [ ] ç”»é¢ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ€ãƒ¡ãƒ¼ã‚¸æ™‚ã«ç”»é¢ãŒä¸€ç¬èµ¤ããªã‚‹ï¼‰
- [ ] ãƒ’ãƒƒãƒˆã‚¹ãƒˆãƒƒãƒ—ï¼ˆå¼·æ”»æ’ƒãƒ’ãƒƒãƒˆæ™‚ã« 2 ãƒ•ãƒ¬ãƒ¼ãƒ åœæ­¢ï¼‰
- [ ] ã‚¹ã‚³ã‚¢è¡¨ç¤ºã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæ’ƒç ´æ™‚ã«æ•°å­—ãŒãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ï¼‰
- [ ] æ­¦å™¨é¸æŠ UI ã®æ”¹å–„ï¼ˆæ­¦å™¨ã®èª¬æ˜æ–‡ãƒ»ãƒ¬ãƒ™ãƒ«è¡¨ç¤ºï¼‰
- [ ] ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ç”»é¢ã®æ”¹å–„ï¼ˆã‚¹ã‚³ã‚¢ãƒ»ç”Ÿå­˜æ™‚é–“ãƒ»æ’ƒç ´æ•°ï¼‰
- [ ] ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ã®è¿½åŠ 
- [ ] è¨­å®šç”»é¢ï¼ˆéŸ³é‡ãƒ»è§£åƒåº¦ï¼‰

### Elixir å´ã®æœ€çµ‚æ•´ç†

```elixir
# çµ±è¨ˆåé›†ï¼ˆElixir ã®å¼·ã¿ã‚’æ´»ã‹ã™ï¼‰
defmodule Game.Stats do
  use GenServer

  # ã‚²ãƒ¼ãƒ ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ±è¨ˆã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åé›†
  def record_kill(enemy_kind, weapon_kind) do
    GenServer.cast(__MODULE__, {:kill, enemy_kind, weapon_kind})
  end

  # ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†æ™‚ã«ã‚µãƒãƒªãƒ¼ã‚’å‡ºåŠ›
  def session_summary do
    GenServer.call(__MODULE__, :summary)
  end
end
```

### ç¢ºèªãƒã‚¤ãƒ³ãƒˆ
- [ ] 30 åˆ†é–“ãƒ—ãƒ¬ã‚¤ã—ã¦ FPS ãŒå®‰å®šã—ã¦ã„ã‚‹
- [ ] é›£æ˜“åº¦ã‚«ãƒ¼ãƒ–ãŒè‡ªç„¶ã«æ„Ÿã˜ã‚‰ã‚Œã‚‹
- [ ] å…¨æ­¦å™¨ãŒã€Œä½¿ã„ãŸã„ã€ã¨æ€ãˆã‚‹
- [ ] ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼å¾Œã«ãƒªãƒ—ãƒ¬ã‚¤ã—ãŸããªã‚‹

---

## ã‚¹ãƒ†ãƒƒãƒ—ã®ä¾å­˜é–¢ä¿‚

```mermaid
flowchart LR
    S15[Step 15\nã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼] --> S16[Step 16\nãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«]
    S16 --> S17[Step 17\næ­¦å™¨ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—]
    S16 --> S18[Step 18\nè¤‡æ•°æ•µã‚¿ã‚¤ãƒ—]
    S17 --> S19[Step 19\nã‚¢ã‚¤ãƒ†ãƒ ãƒ‰ãƒ­ãƒƒãƒ—]
    S18 --> S19
    S19 --> S20[Step 20\nã‚«ãƒ¡ãƒ©ã‚·ã‚¹ãƒ†ãƒ ]
    S17 --> S21[Step 21\næ­¦å™¨è¿½åŠ ]
    S20 --> S22[Step 22\nBGMãƒ»SE]
    S18 --> S23[Step 23\nã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³]
    S21 --> S24[Step 24\nãƒœã‚¹ã‚¨ãƒãƒŸãƒ¼]
    S22 --> S25[Step 25\nãƒãƒ©ãƒ³ã‚¹èª¿æ•´]
    S23 --> S25
    S24 --> S25
```

---

## å„ã‚¹ãƒ†ãƒƒãƒ—ã®å·¥æ•°ç›®å®‰

| ã‚¹ãƒ†ãƒƒãƒ— | ä¸»ãªä½œæ¥­å ´æ‰€ | å·¥æ•°ç›®å®‰ |
|---|---|---|
| Step 16 ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ« | Rust (lib.rs + renderer) | 2ã€œ3 æ™‚é–“ |
| Step 17 æ­¦å™¨ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ— | Rust + Elixir | 2ã€œ3 æ™‚é–“ |
| Step 18 è¤‡æ•°æ•µã‚¿ã‚¤ãƒ— | Rust + Python (atlas) | 3ã€œ4 æ™‚é–“ |
| Step 19 ã‚¢ã‚¤ãƒ†ãƒ ãƒ‰ãƒ­ãƒƒãƒ— | Rust | 2ã€œ3 æ™‚é–“ |
| Step 20 ã‚«ãƒ¡ãƒ©ã‚·ã‚¹ãƒ†ãƒ  | Rust (renderer + WGSL) | 3ã€œ4 æ™‚é–“ |
| Step 21 æ­¦å™¨è¿½åŠ  | Rust + Elixir | 3ã€œ4 æ™‚é–“ |
| Step 22 BGMãƒ»SE | Rust (æ–°è¦ audio.rs) | 2ã€œ3 æ™‚é–“ |
| Step 23 ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ | Rust + Python (atlas) | 3ã€œ4 æ™‚é–“ |
| Step 24 ãƒœã‚¹ã‚¨ãƒãƒŸãƒ¼ | Rust + Elixir | 4ã€œ5 æ™‚é–“ |
| Step 25 ãƒãƒ©ãƒ³ã‚¹èª¿æ•´ | å…¨ä½“ | 3ã€œ5 æ™‚é–“ |

**åˆè¨ˆ: ç´„ 27ã€œ38 æ™‚é–“**

---

## æ¨å¥¨å®Ÿè£…é †åº

æœ€ã‚‚ã‚²ãƒ¼ãƒ ã®ã€Œæ°—æŒã¡ã‚ˆã•ã€ã«ç›´çµã™ã‚‹ã‚‚ã®ã‹ã‚‰ç€æ‰‹ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

1. **Step 16ï¼ˆãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ï¼‰** â†’ å³åº§ã«ã€Œãƒ’ãƒƒãƒˆæ„Ÿã€ãŒç”Ÿã¾ã‚Œã‚‹
2. **Step 17ï¼ˆæ­¦å™¨ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼‰** â†’ ã‚²ãƒ¼ãƒ ã®ç¸¦è»¸ï¼ˆæˆé•·æ„Ÿï¼‰ãŒç”Ÿã¾ã‚Œã‚‹
3. **Step 18ï¼ˆè¤‡æ•°æ•µã‚¿ã‚¤ãƒ—ï¼‰** â†’ æˆ¦ç•¥çš„å¤šæ§˜æ€§ãŒç”Ÿã¾ã‚Œã‚‹
4. **Step 22ï¼ˆBGMãƒ»SEï¼‰** â†’ æ²¡å…¥æ„ŸãŒå¤§å¹…ã‚¢ãƒƒãƒ—
5. ä»¥é™ã¯å¥½ã¿ã®é †ã§

---

> **ã€Œå‹•ãã‚²ãƒ¼ãƒ ã‹ã‚‰ã€æ¥½ã—ã„ã‚²ãƒ¼ãƒ ã¸ã€‚ã€**  
> æŠ€è¡“çš„ãªæ­£ã—ã•ã ã‘ã§ãªãã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ„Ÿæƒ…ã«è¨´ãˆã‹ã‘ã‚‹ã“ã¨ãŒã€ã‚¯ã‚ªãƒªãƒ†ã‚£ã‚¢ãƒƒãƒ—ã®æœ¬è³ªã§ã™ã€‚
