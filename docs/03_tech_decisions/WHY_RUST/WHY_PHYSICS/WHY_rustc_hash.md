# なぜ rustc-hash をハッシュに選ぶのか

このドキュメントでは、Spatial Hash 等のハッシュテーブルに rustc-hash を採用した技術的根拠を説明します。物理演算・衝突判定の高速化に寄与します。

---

## 目次

1. [rustc-hash とは](#1-rustc-hash-とは)
2. [採用理由](#2-採用理由)
3. [本プロジェクトでの利用](#3-本プロジェクトでの利用)
4. [関連ドキュメント](#4-関連ドキュメント)

---

## 1. rustc-hash とは

rustc-hash は、Rust コンパイラ（rustc）内部で使用されている FxHash を提供するライブラリです。

- **バージョン**: rustc-hash 2（Cargo.toml）
- **役割**: 高速なハッシュ関数
- **用途**: Spatial Hash（空間ハッシュ）、衝突判定の空間分割

---

## 2. 採用理由

### 2.1 高速

FxHash は SipHash（標準 `HashMap` のデフォルト）より高速です。整数キーや小さいキーで特に有利で、ゲームの空間ハッシュ（座標ベース）に適しています。

### 2.2 コンパイラ実績

rustc 自身が使用しているため、十分にテスト・検証されています。品質とパフォーマンスが保証されています。

### 2.3 DoS 耐性は不要

標準 `HashMap` の SipHash は DoS 攻撃対策で慎重に設計されています。ゲームの空間ハッシュでは外部入力がハッシュキーに直結せず、速度を優先して FxHash を選べます。

### 2.4 軽量

依存が少なく、ビルド時間・バイナリサイズへの影響は小さいです。

---

## 3. 本プロジェクトでの利用

- **用途**: Spatial Hash（空間ハッシュ）のハッシュテーブル
- **目的**: 衝突判定の高速化。全対全ではなく、近傍セル内のエンティティ同士のみ判定することで O(N) を実質 O(N × 近傍数) に抑える
- **連携**: 敵・弾丸の位置をセル ID にハッシュし、同セル内のペアのみ衝突判定

---

## 4. 関連ドキュメント

| ドキュメント | 用途 |
|-------------|------|
| [WHY_RAYON.md](../WHY_RAYON.md) | Chase AI 並列化（同じ物理演算パイプライン内） |
| [WHY_RUST.md](../WHY_RUST.md) | Rust 採用の技術的根拠。物理演算は Rust 担当 |
