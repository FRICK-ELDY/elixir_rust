# なぜ egui をデバッグ UI に選ぶのか

このドキュメントでは、デバッグ用オーバーレイ UI として egui を採用した技術的根拠を説明します。wgpu による描画と密接に連携します。

---

## 目次

1. [egui とは](#1-egui-とは)
2. [採用理由](#2-採用理由)
3. [wgpu との連携](#3-wgpu-との連携)
4. [本プロジェクトでの利用](#4-本プロジェクトでの利用)
5. [関連ドキュメント](#5-関連ドキュメント)

---

## 1. egui とは

egui は、Rust 製の即座モード（immediate mode）GUI ライブラリです。軽量で、デバッグ・ツール・オーバーレイ UI に適しています。

- **バージョン**: egui 0.31、egui-wgpu 0.31、egui-winit 0.31（Cargo.toml）
- **役割**: デバッグ用オーバーレイ UI（FPS、敵数、物理時間等の表示）
- **構成**:
  - **egui**: GUI コア（ウィジェット、レイアウト）
  - **egui-wgpu**: wgpu バックエンド（描画）
  - **egui-winit**: winit 連携（入力、ウィンドウイベント）

---

## 2. 採用理由

### 2.1 即座モードの簡潔さ

即座モード GUI では、毎フレーム「今表示したい UI」をそのままコードで記述します。状態を別途保持せず、デバッグ表示のような動的コンテンツに適しています。

```rust
egui::Window::new("Debug").show(ctx, |ui| {
    ui.label(format!("FPS: {}", fps));
    ui.label(format!("Enemies: {}", enemy_count));
});
```

### 2.2 wgpu バックエンドの存在

`egui-wgpu` により、egui の描画を wgpu パイプラインに統合できます。別の描画 API を混在させる必要がありません。ゲームの描画パスに egui のレンダリングを追加するだけで済みます。

### 2.3 軽量・依存が少ない

フル機能の GUI ツールキット（Qt、GTK 等）と比べて依存が少なく、ビルド時間・バイナリサイズへの影響が小さいです。デバッグ用途には十分な機能を備えています。

### 2.4 クロスプラットフォーム

Windows、macOS、Linux で同じ見た目・挙動を提供します。wgpu + winit の構成と相性が良く、本プロジェクトの描画スタックに自然に組み込めます。

---

## 3. wgpu との連携

egui は wgpu の `RenderPass` に描画を記録します。

```
ゲームの描画パス:
  1. wgpu でスプライト・パーティクル・HUD を描画
  2. egui の shapes を wgpu テクスチャにラスタライズ
  3. そのテクスチャを wgpu で描画（オーバーレイ）
```

`egui-wgpu` が egui の描画コマンドを wgpu のバッファ・テクスチャに変換し、既存の wgpu パイプラインに組み込みます。egui 用のフォントアトラスも wgpu テクスチャとして管理されます。

---

## 4. 本プロジェクトでの利用

- **用途**: デバッグオーバーレイ（敵数、弾丸数、physics_ms、シーン種別等）
- **連携**: `Engine.FrameCache` から Elixir 側で集計したデータを Rust が受け取り、egui で表示
- **表示内容**: パフォーマンス指標、ゲーム状態の可視化

---

## 5. 関連ドキュメント

| ドキュメント | 用途 |
|-------------|------|
| [WHY_wgpu.md](./WHY_wgpu.md) | wgpu の選定理由（描画基盤） |
| [WHY_winit.md](./WHY_winit.md) | winit（egui-winit で入力連携）の選定理由 |
| [WHY_RUST.md](../WHY_RUST.md) | Rust 採用の技術的根拠。依存関係一覧あり |
