# なぜ bytemuck を使うのか

このドキュメントでは、バイト列と構造体の変換に bytemuck を採用した技術的根拠を説明します。wgpu へのテクスチャデータ渡しに使用します。

---

## 目次

1. [bytemuck とは](#1-bytemuck-とは)
2. [採用理由](#2-採用理由)
3. [本プロジェクトでの利用](#3-本プロジェクトでの利用)
4. [関連ドキュメント](#4-関連ドキュメント)

---

## 1. bytemuck とは

bytemuck は、型安全にバイト列と構造体を相互変換するライブラリです。`Pod` と `Zeroable` トレイトを提供します。

- **バージョン**: bytemuck 1（features: ["derive"]）（Cargo.toml）
- **役割**: テクスチャデータの wgpu バッファへの書き込み
- **用途**: スプライト頂点データ、ユニフォーム等の GPU 転送

---

## 2. 採用理由

### 2.1 wgpu との相性

wgpu は `Queue::write_buffer` 等で `&[u8]` を受け取ります。構造体をバイト列として転送する際、`bytemuck::bytes_of` により型安全に変換できます。`unsafe` な transmute を避けられます。

### 2.2 derive による簡潔さ

`#[derive(Pod, Zeroable)]` でカスタム頂点構造体等にトレイトを付与できます。手動実装の手間が省けます。

### 2.3 ゼロコスト

変換はコンパイル時に正しさが保証され、実行時のオーバーヘッドはありません。ゲームループ内の描画パスに適しています。

---

## 3. 本プロジェクトでの利用

- **用途**: スプライト頂点（位置、UV 等）の wgpu バッファへの書き込み
- **連携**: `image` で読み込んだテクスチャデータを wgpu に渡す際の型変換
- **Pod / Zeroable**: カスタム頂点・ユニフォーム構造体に derive

---

## 4. 関連ドキュメント

| ドキュメント | 用途 |
|-------------|------|
| [WHY_wgpu.md](./WHY_wgpu.md) | wgpu の選定理由 |
| [WHY_image.md](./WHY_image.md) | 画像読み込み（テクスチャソース） |
| [WHY_RUST.md](../WHY_RUST.md) | Rust 採用の技術的根拠 |
