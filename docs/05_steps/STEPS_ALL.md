# 実装ステップ一覧（章・節・項構成）

**目的**: ゲームエンジン実装を**章 → 節 → 項**で整理し、全体像と推奨順序を把握しやすくする。  
**詳細な手順・コード例**は各節の元ドキュメントを参照すること。

**構成**:
- **第1章 ゲームエンジン基礎**: Step 1〜47 を、第1節（基礎）〜第5節（拡張）の**項**として配置する。
- **第2章 ゲームエンジン応用**: Rust lib 分割・2D 固め・EOS・3D・Slot など、今後の Step を**節・項**として決めていく。

**表記例**: **1章1節1項** = 第1章 ゲームエンジン基礎 第1節 基礎 第1項（旧 Step 1）。各節の表では、文脈が明らかな場合に「○項」と略記する。

---

## 全体ロードマップ

| 章 | 節 | 項 | 内容 | 旧 Step |
|----|-----|-----|------|---------|
| **第1章 ゲームエンジン基礎** | 第1節 基礎 | 1項〜15項 | 環境構築〜ゲームオーバー・リスタートまで「動くゲーム」 | 1〜15 |
|  | 第2節 クオリティ | 1項〜10項 | ヒットエフェクト〜ボス・バランスで「楽しめるゲーム」 | 16〜25 |
|  | 第3節 パフォーマンス | 1項〜6項 | イベントバス・ETS・フリーリスト・Spatial Hash・Telemetry・SIMD | 26〜31 |
|  | 第4節 汎用化 | 1項〜9項 | Game インターフェース・シーン汎用化・ゲーム分離・2 つ目のゲーム土台 | 32〜40 |
|  | 第5節 拡張 | 1項〜7項 | ゲームループ Rust 移行・マップ・セーブ・マルチ・デバッグ・リネーム・SPEC コンテンツ | 41〜47 |
| **第2章 ゲームエンジン応用** | 第1節 Rust lib 分割・整理 | 1項〜6項 | lib.rs の分割・フォルダ構成。3D・Slot の**前**に実施（[STEPS_RUST_LIB.md](./STEPS_RUST_LIB.md)） | R-LIB-1〜6 |
|  | 第2節 2Dゲームの固め | — | 2D サバイバーを仕様・バランス・品質として固める | — |
|  | 第3節 EOS 実装 | — | 友達・ロビー・セッションを EOS で実装（[EPIC_ONLINE_SERVICES.md](../06_system_design/EPIC_ONLINE_SERVICES.md)） | — |
|  | 第4節 3D・三人称FPS | 1項〜7項 | **据え置き**。WGPU 3D 基盤・カメラ・メッシュ・プレイヤー制御・射撃・敵AI・UI（[STEPS_3D.md](./STEPS_3D.md)） | 48〜54 |
|  | 第5節 Slot・コンポーネント | 1項〜7項 | **据え置き**。シーングラフ（Slot）と Component を Elixir で管理（[STEPS_SLOT_COMPONENT.md](./STEPS_SLOT_COMPONENT.md)） | 55〜61 |

---

## 第1章 ゲームエンジン基礎

Step 1〜47 を、第1節（基礎）〜第5節（拡張）の**項**として配置する。

---

### 第1章 第1節 基礎（1章1節1項〜1章1節15項）

| 項 | 目標 | 備考 | 旧 Step |
|-----|------|------|---------|
| 1項 | 環境構築 | | 1 |
| 2項 | ウィンドウ表示（Rust クレート・winit） | | 2 |
| 3項 | wgpu 初期化・単色クリア | | 3 |
| 4項 | スプライト 1 枚描画 | | 4 |
| 5項 | インスタンシング描画（100 体） | | 5 |
| 6項 | NIF 連携（Elixir + Rustler） | | 6 |
| 7項 | ゲームループ（GenServer 60 Hz） | ※1章5節1項（旧 Step 41）で Rust に移行 | 7 |
| 8項 | プレイヤー移動 | | 8 |
| 9項 | 敵スポーン・追跡 AI | | 9 |
| 10項 | 衝突判定（Spatial Hash） | | 10 |
| 11項 | 武器・弾丸システム | | 11 |
| 12項 | 大規模スポーン・最適化（5000 体） | | 12 |
| 13項 | UI（HP・スコア・タイマー） | | 13 |
| 14項 | レベルアップ・武器選択 | | 14 |
| 15項 | ゲームオーバー・リスタート | | 15 |

**詳細**: [STEPS_BASE.md](./STEPS_BASE.md)

---

### 第1章 第2節 クオリティ（1章2節1項〜1章2節10項）

| 項 | 目標 | 旧 Step |
|-----|------|---------|
| 1項 | ヒットエフェクト（パーティクル） | 16 |
| 2項 | 武器レベルアップ（重ね強化） | 17 |
| 3項 | 複数敵タイプ | 18 |
| 4項 | アイテムドロップ（回復・磁石） | 19 |
| 5項 | カメラシステム（プレイヤー追従） | 20 |
| 6項 | 武器追加（Whip / Fireball / Lightning） | 21 |
| 7項 | BGM・SE（rodio） | 22 |
| 8項 | スプライトアニメーション | 23 |
| 9項 | ボスエネミー | 24 |
| 10項 | バランス調整・ポリッシュ | 25 |

**詳細**: [STEPS_QUALITY.md](./STEPS_QUALITY.md)

---

### 第1章 第3節 パフォーマンス（1章3節1項〜1章3節6項）

| 項 | 目標 | 備考 | 旧 Step |
|-----|------|------|---------|
| 1項 | イベントバス | フレームイベントを Elixir に配信 | 26 |
| 2項 | ETS キャッシュ・入力ポーリング | プロセス間通信の最適化 | 27 |
| 3項 | フリーリスト（スポーン O(1)） | P3 | 28 |
| 4項 | Spatial Hash 最近接・RwLock | AI 高速化（P1, P2） | 29 |
| 5項 | Telemetry 計測基盤 | 観測可能性（P7） | 30 |
| 6項 | SIMD AI 高速化（オプション） | P4 | 31 |

**推奨順（パフォーマンス優先）**: 4項 → 3項 → 1項 → 2項 → 5項 → 6項  
**詳細**: [STEPS_PERF.md](./STEPS_PERF.md)  
**分析・課題整理**: [STEPS_PERFORMANCE_ANALYSIS.md](./STEPS_PERFORMANCE_ANALYSIS.md)

---

### 第1章 第4節 汎用化（1章4節1項〜1章4節9項）

| 項 | 目標 | 旧 Step |
|-----|------|---------|
| 1項 | Game インターフェース設計 | 32 |
| 2項 | render_type 汎用化 | 33 |
| 3項 | ゲーム切替（config） | 34 |
| 4項 | ゲーム分離（vampire_survivor） | 35 |
| 5項 | Game behaviour 実装 | 36 |
| 6項 | エンジン API 安定化 | 37 |
| 7項 | entity_registry（データ駆動） | 38 |
| 8項 | ゲーム別アセットパス | 39 |
| 9項 | 2 つ目のゲーム（ミニマル実装） | 40 |

**詳細**: [STEPS_GENERALIZATION.md](./STEPS_GENERALIZATION.md)

---

### 第1章 第5節 拡張（1章5節1項〜1章5節7項）

| 項 | 目標 | 備考 | 旧 Step |
|-----|------|------|---------|
| 1項 | ゲームループの Rust 移行（高精度 60 Hz） | 1章1節7項のゲームループを Rust 側に移行 | 41 |
| 2項 | マップ・障害物システム | | 42 |
| 3項 | セーブ・ロード | | 43 |
| 4項 | マルチプレイ基盤（ルーム管理） | | 44 |
| 5項 | デバッグ支援（NIF） | | 45 |
| 6項 | GameLoop を GameEvents にリネーム | Elixir 側の役割（frame_events 受信・フェーズ管理）に合わせてモジュール名を変更 | 46 |
| 7項 | SPEC 未実装コンテンツ（Skeleton / Ghost / Garlic / 壁すり抜け） | 2項完了後が望ましい | 47 |

**推奨順序**: 1項 → 5項 → 2項 → 3項 → 4項 → 6項（2項と3項は並行可）。7項は 2項完了後が望ましい。  
**詳細**: [STEPS_EXTENSION.md](./STEPS_EXTENSION.md)

---

## 第2章 ゲームエンジン応用

第1章（Step 1〜47）完了後、Rust lib 分割・2D 固め・EOS・3D・Slot など、今後の Step を**節・項**として決めていく。

---

### 第2章 第1節 Rust lib 分割・整理（2章1節1項〜2章1節6項）

| 項 | 目標 | 旧 Step |
|-----|------|---------|
| 1項 | ブロック切り出し順序の決定 | R-LIB-1 |
| 2項 | `world/` の作成と型定義の移動 | R-LIB-2 |
| 3項 | `game_logic/` の作成とロジックの移動 | R-LIB-3 |
| 4項 | `nif/` の作成と NIF 関数の移動 | R-LIB-4 |
| 5項 | `lib.rs` のスリム化と動作確認 | R-LIB-5 |
| 6項 | ドキュメント更新 | R-LIB-6 |

> 3D・Slot の**前**に実施。第1章完了後に着手する。

**詳細**: [STEPS_RUST_LIB.md](./STEPS_RUST_LIB.md)

---

### 第2章 第2節 2Dゲームの固め（2章2節）

2章1節完了後、2D サバイバーを仕様・バランス・品質として固める。項は今後決める。

---

### 第2章 第3節 EOS 実装（2章3節）

2章2節完了後、友達・ロビー・セッションを EOS で実装する。項は今後決める。

**詳細**: [EPIC_ONLINE_SERVICES.md](../06_system_design/EPIC_ONLINE_SERVICES.md)

---

### 第2章 第4節 3D・三人称 FPS（2章4節・据え置き）

> **据え置き**: 本節は当面保留。2章1節〜2章3節の後に再検討する。

| 項 | 目標 | 備考 | 旧 Step |
|-----|------|------|---------|
| 1項 | 3D レンダリング基盤 | wgpu で 3D パイプライン・深度バッファ・頂点/法線/UV | 48 |
| 2項 | 3D カメラ・三人称視点 | View/Projection 行列・カメラ追従 | 49 |
| 3項 | 3D メッシュ描画・アトラス流用 | 既存スプライトアトラスを 3D テクスチャに | 50 |
| 4項 | 三人称プレイヤー制御 | 移動・カメラ追従・照準（WASD・マウス） | 51 |
| 5項 | 射撃・弾丸・レイキャスト | FPS 武器・ヒット判定 | 52 |
| 6項 | 敵の 3D スポーン・AI・衝突 | 敵配置・Chase AI・ダメージ・経験値 | 53 |
| 7項 | UI・アセット流用・ポリッシュ | HUD・BGM/SE 流用・ゲーム選択統合 | 54 |

**詳細**: [STEPS_3D.md](./STEPS_3D.md)

---

### 第2章 第5節 Slot・コンポーネント（2章5節・据え置き）

> **据え置き**: 本節は当面保留。2章4節完了後に実施する。

| 項 | 目標 | 備考 | 旧 Step |
|-----|------|------|---------|
| 1項 | Slot（transform 階層）のデータ構造 | Elixir で id / parent_id / local_transform を管理 | 55 |
| 2項 | コンポーネント型・レジストリと Slot への付与 | Camera, Player, Enemy, Mesh 等の型と Slot への付与 | 56 |
| 3項 | ワールド行列計算・シーンスナップショット・Rust 連携 | 毎フレーム Elixir → Rust にスナップショットを渡して描画 | 57 |
| 4項 | 物理結果の Rust → Elixir 反映（Slot 同期） | 物理ステップの結果で Slot の位置を更新 | 58 |
| 5項 | シーンシリアライズ・保存/ロード | シーンファイル形式・バージョン・ロード | 59 |
| 6項 | Prefab とインスタンス | 再利用可能な Slot サブツリー・インスタンス化とオーバーライド | 60 |
| 7項 | ビジュアルエディタ向け基盤 | コンポーネントスキーマ公開・選択・Undo の検討と最小実装 | 61 |

**詳細**: [STEPS_SLOT_COMPONENT.md](./STEPS_SLOT_COMPONENT.md)

---

## 依存関係（概要）

- **第1章第1節（1項〜15項）**: 直列（環境 → ウィンドウ → 描画 → NIF → ループ → ゲームプレイ）
- **第1章第2節（1項〜10項）**: 第1節完了後、直列または一部並行可能
- **第1章第3節（1項〜6項）**: 第2節完了後。4項/3項を先にするとパフォーマンス効果が大きい
- **第1章第4節（1項〜9項）**: 第3節完了後。汎用化は 1項→…→9項 の順が無難
- **第1章第5節（1項〜7項）**: 第4節完了後。1項を優先すると他項の土台ができる。6項は 1項完了後であればいつでも実施可。7項は 2項完了後が望ましい
- **第2章第1節**: 第1章完了後。3D・Slot の**前**に実施
- **第2章第2節**: 2章1節完了後。2D の仕様・バランス・品質を固める
- **第2章第3節**: 2章2節完了後。EOS で友達・ロビー・セッションを実装
- **第2章第4節（据え置き）**: 上記が一区切りついた後に再検討
- **第2章第5節（据え置き）**: 2章4節完了後

---

## 関連ドキュメント

| ドキュメント | 用途 |
|-------------|------|
| [STEPS_BASE.md](./STEPS_BASE.md) | 第1章第1節（1項〜15項）の詳細手順・コード |
| [STEPS_QUALITY.md](./STEPS_QUALITY.md) | 第1章第2節（1項〜10項）の詳細手順・コード |
| [STEPS_PERF.md](./STEPS_PERF.md) | 第1章第3節（1項〜6項）の詳細手順・コード |
| [STEPS_PERFORMANCE_ANALYSIS.md](./STEPS_PERFORMANCE_ANALYSIS.md) | パフォーマンス課題の分析・提案 |
| [STEPS_EXTENSION.md](./STEPS_EXTENSION.md) | 第1章第5節（1項〜7項）の詳細 |
| [STEPS_GENERALIZATION.md](./STEPS_GENERALIZATION.md) | 第1章第4節（1項〜9項）汎用化の詳細 |
| [STEPS_RUST_LIB.md](./STEPS_RUST_LIB.md) | 第2章第1節 Rust lib 分割・フォルダ構成検討 |
| [STEPS_3D.md](./STEPS_3D.md) | 第2章第4節（1項〜7項）3D・三人称 FPS の詳細（**据え置き**） |
| [STEPS_SLOT_COMPONENT.md](./STEPS_SLOT_COMPONENT.md) | 第2章第5節（1項〜7項）Slot・コンポーネントの詳細（**据え置き**） |
| [EPIC_ONLINE_SERVICES.md](../06_system_design/EPIC_ONLINE_SERVICES.md) | 第2章第3節 EOS 実装 |
| [PRIORITY_STEPS.md](../04_roadmap/PRIORITY_STEPS.md) | 実施優先度（P1〜P7, G1〜G3） |
| [SPEC.md](../01_setup/SPEC.md) | ゲーム仕様・技術仕様 |
