# 実装ステップ一覧（章・節・項構成）

**目的**: ゲームエンジン実装を**章 → 節 → 項**で整理し、全体像と推奨順序を把握しやすくする。  
**詳細な手順・コード例**は各節の元ドキュメントを参照すること。

**構成**:
- **1. ゲームエンジン基礎**: Step 1〜47 を、1. 基礎〜5. 拡張の**項**として配置する。
- **2. ゲームエンジン応用**: Rust lib 分割・2D 固め・EOS・3D・Slot など、今後の Step を**節・項**として決めていく。

**表記例**: **1.1.1** = 1章 1節 1項。各節の表では、文脈が明らかな場合に「○.」と略記する。

---

## 全体ロードマップ

| 章 | 節 | 項 | 内容 |
|----|-----|-----|------|
| **1. ゲームエンジン基礎** | 1. 基礎 | 全15項 | 環境構築〜ゲームオーバー・リスタートまで「動くゲーム」 |
|  | 2. クオリティ | 全10項 | ヒットエフェクト〜ボス・バランスで「楽しめるゲーム」 |
|  | 3. パフォーマンス | 全6項 | イベントバス・ETS・フリーリスト・Spatial Hash・Telemetry・SIMD |
|  | 4. 汎用化 | 全9項 | Game インターフェース・シーン汎用化・ゲーム分離・2 つ目のゲーム土台 |
|  | 5. 拡張 | 全7項 | ゲームループ Rust 移行・マップ・セーブ・マルチ・デバッグ・リネーム・SPEC コンテンツ |
| **2. ゲームエンジン応用** | 1. Rust lib 分割・整理 | 全6項 | lib.rs の分割・フォルダ構成。3D・Slot の**前**に実施（[STEPS_RUST_LIB.md](./STEPS_RUST_LIB.md)） |
|  | 2. 2Dゲームの固め | — | 2D サバイバーを仕様・バランス・品質として固める |
|  | 3. EOS 実装 | — | 友達・ロビー・セッションを EOS で実装（[EPIC_ONLINE_SERVICES.md](../06_system_design/EPIC_ONLINE_SERVICES.md)） |
|  | 4. 3D・三人称FPS | 全7項 | **据え置き**。WGPU 3D 基盤・カメラ・メッシュ・プレイヤー制御・射撃・敵AI・UI（[STEPS_3D.md](./STEPS_3D.md)） |
|  | 5. Slot・コンポーネント | 全7項 | **据え置き**。シーングラフ（Slot）と Component を Elixir で管理（[STEPS_SLOT_COMPONENT.md](./STEPS_SLOT_COMPONENT.md)） |

---

## 1. ゲームエンジン基礎

Step 1〜47 を、1. 基礎〜5. 拡張の**項**として配置する。

---

### 1.1  基礎（全15項）

| 項 | 目標 | 備考 |
|-----|------|------|
| 1. | 環境構築 | |
| 2. | ウィンドウ表示（Rust クレート・winit） | |
| 3. | wgpu 初期化・単色クリア | |
| 4. | スプライト 1 枚描画 | |
| 5. | インスタンシング描画（100 体） | |
| 6. | NIF 連携（Elixir + Rustler） | |
| 7. | ゲームループ（GenServer 60 Hz） | ※1.5.1 で Rust に移行 |
| 8. | プレイヤー移動 | |
| 9. | 敵スポーン・追跡 AI | |
| 10. | 衝突判定（Spatial Hash） | |
| 11. | 武器・弾丸システム | |
| 12. | 大規模スポーン・最適化（5000 体） | |
| 13. | UI（HP・スコア・タイマー） | |
| 14. | レベルアップ・武器選択 | |
| 15. | ゲームオーバー・リスタート | |

**詳細**: [STEPS_BASE.md](./STEPS_BASE.md)

---

### 1.2  クオリティ（全10項）

| 項 | 目標 |
|-----|------|
| 1. | ヒットエフェクト（パーティクル） |
| 2. | 武器レベルアップ（重ね強化） |
| 3. | 複数敵タイプ |
| 4. | アイテムドロップ（回復・磁石） |
| 5. | カメラシステム（プレイヤー追従） |
| 6. | 武器追加（Whip / Fireball / Lightning） |
| 7. | BGM・SE（rodio） |
| 8. | スプライトアニメーション |
| 9. | ボスエネミー |
| 10. | バランス調整・ポリッシュ |

**詳細**: [STEPS_QUALITY.md](./STEPS_QUALITY.md)

---

### 1.3 パフォーマンス（全6項）

| 項 | 目標 | 備考 |
|-----|------|------|
| 1. | イベントバス | フレームイベントを Elixir に配信 |
| 2. | ETS キャッシュ・入力ポーリング | プロセス間通信の最適化 |
| 3. | フリーリスト（スポーン O(1)） | P3 |
| 4. | Spatial Hash 最近接・RwLock | AI 高速化（P1, P2） |
| 5. | Telemetry 計測基盤 | 観測可能性（P7） |
| 6. | SIMD AI 高速化（オプション） | P4 |

**推奨順（パフォーマンス優先）**: 4. → 3. → 1. → 2. → 5. → 6.  
**詳細**: [STEPS_PERF.md](./STEPS_PERF.md)  
**分析・課題整理**: [STEPS_PERFORMANCE_ANALYSIS.md](./STEPS_PERFORMANCE_ANALYSIS.md)

---

### 1.4 汎用化（全9項）

| 項 | 目標 |
|-----|------|
| 1. | Game インターフェース設計 |
| 2. | render_type 汎用化 |
| 3. | ゲーム切替（config） |
| 4. | ゲーム分離（vampire_survivor） |
| 5. | Game behaviour 実装 |
| 6. | エンジン API 安定化 |
| 7. | entity_registry（データ駆動） |
| 8. | ゲーム別アセットパス |
| 9. | 2 つ目のゲーム（ミニマル実装） |

**詳細**: [STEPS_GENERALIZATION.md](./STEPS_GENERALIZATION.md)

---

### 1.5 拡張（全7項）

| 項 | 目標 | 備考 |
|-----|------|------|
| 1. | ゲームループの Rust 移行（高精度 60 Hz） | 1.1.7 のゲームループを Rust 側に移行 |
| 2. | マップ・障害物システム | |
| 3. | セーブ・ロード | |
| 4. | マルチプレイ基盤（ルーム管理） | |
| 5. | デバッグ支援（NIF） | |
| 6. | GameLoop を GameEvents にリネーム | Elixir 側の役割（frame_events 受信・フェーズ管理）に合わせてモジュール名を変更 |
| 7. | SPEC 未実装コンテンツ（Skeleton / Ghost / Garlic / 壁すり抜け） | 2.完了後が望ましい |

**推奨順序**: 1. → 5. → 2. → 3. → 4. → 6.（2.と3.は並行可）。7.は 2.完了後が望ましい。  
**詳細**: [STEPS_EXTENSION.md](./STEPS_EXTENSION.md)

---

## 2. ゲームエンジン応用

1章（Step 1〜47）完了後、Rust lib 分割・2D 固め・EOS・3D・Slot など、今後の Step を**節・項**として決めていく。

---

### 2.1  Rust lib 分割・整理（全6項）

| 項 | 目標 |
|-----|------|
| 1. | ブロック切り出し順序の決定 |
| 2. | `world/` の作成と型定義の移動 |
| 3. | `game_logic/` の作成とロジックの移動 |
| 4. | `nif/` の作成と NIF 関数の移動 |
| 5. | `lib.rs` のスリム化と動作確認 |
| 6. | ドキュメント更新 |

> 3D・Slot の**前**に実施。1章完了後に着手する。

**詳細**: [STEPS_RUST_LIB.md](./STEPS_RUST_LIB.md)

---

### 2.2  2Dゲームの固め

2.1 完了後、2D サバイバーを仕様・バランス・品質として固める。項は今後決める。

---

### 2.3 EOS 実装

2.2 完了後、友達・ロビー・セッションを EOS で実装する。項は今後決める。

**詳細**: [EPIC_ONLINE_SERVICES.md](../06_system_design/EPIC_ONLINE_SERVICES.md)

---

### 2.4  3D・三人称 FPS（全7項・据え置き）

> **据え置き**: 本節は当面保留。2.1〜2.3 の後に再検討する。

| 項 | 目標 | 備考 |
|-----|------|------|
| 1. | 3D レンダリング基盤 | wgpu で 3D パイプライン・深度バッファ・頂点/法線/UV |
| 2. | 3D カメラ・三人称視点 | View/Projection 行列・カメラ追従 |
| 3. | 3D メッシュ描画・アトラス流用 | 既存スプライトアトラスを 3D テクスチャに |
| 4. | 三人称プレイヤー制御 | 移動・カメラ追従・照準（WASD・マウス） |
| 5. | 射撃・弾丸・レイキャスト | FPS 武器・ヒット判定 |
| 6. | 敵の 3D スポーン・AI・衝突 | 敵配置・Chase AI・ダメージ・経験値 |
| 7. | UI・アセット流用・ポリッシュ | HUD・BGM/SE 流用・ゲーム選択統合 |

**詳細**: [STEPS_3D.md](./STEPS_3D.md)

---

### 2.5 Slot・コンポーネント（全7項・据え置き）

> **据え置き**: 本節は当面保留。2.4 完了後に実施する。

| 項 | 目標 | 備考 |
|-----|------|------|
| 1. | Slot（transform 階層）のデータ構造 | Elixir で id / parent_id / local_transform を管理 |
| 2. | コンポーネント型・レジストリと Slot への付与 | Camera, Player, Enemy, Mesh 等の型と Slot への付与 |
| 3. | ワールド行列計算・シーンスナップショット・Rust 連携 | 毎フレーム Elixir → Rust にスナップショットを渡して描画 |
| 4. | 物理結果の Rust → Elixir 反映（Slot 同期） | 物理ステップの結果で Slot の位置を更新 |
| 5. | シーンシリアライズ・保存/ロード | シーンファイル形式・バージョン・ロード |
| 6. | Prefab とインスタンス | 再利用可能な Slot サブツリー・インスタンス化とオーバーライド |
| 7. | ビジュアルエディタ向け基盤 | コンポーネントスキーマ公開・選択・Undo の検討と最小実装 |

**詳細**: [STEPS_SLOT_COMPONENT.md](./STEPS_SLOT_COMPONENT.md)

---

## 依存関係（概要）

- **1.1（全15項）**: 直列（環境 → ウィンドウ → 描画 → NIF → ループ → ゲームプレイ）
- **1.2（全10項）**: 1.1 完了後、直列または一部並行可能
- **1.3（全6項）**: 1.2 完了後。4. / 3. を先にするとパフォーマンス効果が大きい
- **1.4（全9項）**: 1.3 完了後。汎用化は 1.→…→9. の順が無難
- **1.5（全7項）**: 1.4 完了後。1.を優先すると他項の土台ができる。6.は 1.完了後であればいつでも実施可。7.は 2.完了後が望ましい
- **2.1**: 1章完了後。3D・Slot の**前**に実施
- **2.2**: 2.1 完了後。2D の仕様・バランス・品質を固める
- **2.3**: 2.2 完了後。EOS で友達・ロビー・セッションを実装
- **2.4（据え置き）**: 上記が一区切りついた後に再検討
- **2.5（据え置き）**: 2.4 完了後

---

## 関連ドキュメント

| ドキュメント | 用途 |
|-------------|------|
| [STEPS_BASE.md](./STEPS_BASE.md) | 1.1（全15項）の詳細手順・コード |
| [STEPS_QUALITY.md](./STEPS_QUALITY.md) | 1.2（全10項）の詳細手順・コード |
| [STEPS_PERF.md](./STEPS_PERF.md) | 1.3（全6項）の詳細手順・コード |
| [STEPS_PERFORMANCE_ANALYSIS.md](./STEPS_PERFORMANCE_ANALYSIS.md) | パフォーマンス課題の分析・提案 |
| [STEPS_EXTENSION.md](./STEPS_EXTENSION.md) | 1.5（全7項）の詳細 |
| [STEPS_GENERALIZATION.md](./STEPS_GENERALIZATION.md) | 1.4（全9項）汎用化の詳細 |
| [STEPS_RUST_LIB.md](./STEPS_RUST_LIB.md) | 2.1 Rust lib 分割・フォルダ構成検討 |
| [STEPS_3D.md](./STEPS_3D.md) | 2.4（全7項）3D・三人称 FPS の詳細（**据え置き**） |
| [STEPS_SLOT_COMPONENT.md](./STEPS_SLOT_COMPONENT.md) | 2.5（全7項）Slot・コンポーネントの詳細（**据え置き**） |
| [EPIC_ONLINE_SERVICES.md](../06_system_design/EPIC_ONLINE_SERVICES.md) | 2.3 EOS 実装 |
| [PRIORITY_STEPS.md](../04_roadmap/PRIORITY_STEPS.md) | 実施優先度（P1〜P7, G1〜G3） |
| [SPEC.md](../01_setup/SPEC.md) | ゲーム仕様・技術仕様 |
