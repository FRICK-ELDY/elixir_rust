# プロジェクト全体評価

**評価対象**: Elixir × Rust ゲームエンジン  
**評価時点**: STEPS_MAP_SAVE_MULTI_DEBUG.md のステップ（Step 40〜45）完了後  
**作成日**: 2026-02-24

> 忌憚なき評価をまとめた。強みも弱みも率直に記載している。

---

## 目次

1. [達成度サマリー](#1-達成度サマリー)
2. [強み](#2-強み)
3. [弱み・課題](#3-弱み課題)
4. [技術的評価](#4-技術的評価)
5. [プロジェクト運営面の評価](#5-プロジェクト運営面の評価)
6. [総合所見](#6-総合所見)
7. [将来の展望](#7-将来の展望)

---

## 1. 達成度サマリー

### 1.1 STEPS_MAP_SAVE_MULTI_DEBUG 完了状況

| Step | 内容 | 状態 | 備考 |
|------|------|------|------|
| 40 | 2つ目のゲーム（ミニマル実装） | ✅ 完了 | Game.MiniShooter 実装。汎用化検証済み |
| 41 | GameLoop Rust 移行 | ✅ 完了 | 高精度 60Hz、イベント駆動連携 |
| 42 | マップ・障害物システム | ✅ 完了 | MapLoader、obstacle_resolve、Spatial Hash 静的障害物 |
| 43 | セーブ・ロード | ✅ 完了 | SaveManager、get_save_snapshot、load_save_snapshot、ハイスコア |
| 44a | マルチプレイ基盤（複数 GameWorld） | ✅ 完了 | RoomSupervisor、RoomRegistry、headless ルーム対応 |
| 44b | Phoenix Channels 連携 | 未着手 | 設計ドキュメントあり。将来実装 |
| 45 | デバッグ支援 | ⚠️ 部分的 | panic_hook、debug_dump_world、RUST_LOG 統合は未実装 |

### 1.2 SPEC.md との照合

| 仕様項目 | 状態 |
|----------|------|
| Slime, Bat, Golem | ✅ 実装済み |
| Skeleton, Ghost | ❌ 未実装 |
| Magic Wand, Axe, Lightning, Whip | ✅ 実装済み |
| Garlic | ❌ 未実装 |
| 障害物（木・岩） | ✅ 実装済み |
| Ghost 壁すり抜け | ⚠️ 基盤あり（kind でスキップ可能）、Ghost 自体未実装 |
| マップ 4096×4096 | ✅ 実装済み |
| ボス（Slime King, Bat Lord, Stone Golem） | ✅ 実装済み |

---

## 2. 強み

### 2.1 アーキテクチャ

- **Elixir と Rust の役割分担が明確** — 「苦手なものは Rust に投げる」方針が設計に一貫して反映されている
- **Engine モジュールによる安定 API** — ゲーム層が NifBridge を直接呼ばず、Engine 経由で利用。境界が明確
- **Game インターフェース** — 複数ゲーム（VampireSurvivor, MiniShooter）を同じ土台で動かせる汎用化が実現している

### 2.2 パフォーマンス

- **Rust 側の最適化が充実** — SoA ECS、フリーリスト、空間ハッシュ、rayon/SIMD、RwLock による並行読取
- **60Hz 高精度ゲームループ** — Step 41 で Rust 主導になり、Process.send_after のジッターを解消
- **GPU インスタンシング** — wgpu による 1 draw call 大量描画

### 2.3 信頼性・拡張性

- **OTP Supervisor** — SceneManager、InputHandler、EventBus、GameLoop 等を監視。障害時はプロセス単位で再起動
- **RoomSupervisor** — 複数ルームを並列管理。Phoenix Channels 連携の土台が整っている
- **EventBus + FrameCache** — フレームイベントのノンブロッキング配信、ETS によるプロセス間共有

### 2.4 ドキュメント

- **設計・仕様・ロードマップが網羅的** — SPEC、ENGINE_ANALYSIS_REVISED、ELIXIR_RUST_DIVISION、STEPS 系が揃っている
- **ステップガイドが実装に追従** — チェックリスト付きで進捗が分かりやすい
- **技術選定の根拠が明文化** — WHY_ELIXIR、WHY_RUST、WHY_RAYON など「なぜ」が残っている

### 2.5 技術的独自性

- **ゲームエンジンとしての OTP 活用** — 他エンジンに少ない、本番サービスの信頼性をゲームに適用した試み
- **分散システムへの自然な拡張** — Elixir/OTP によりマルチノード展開がしやすい設計

---

## 3. 弱み・課題

### 3.1 デバッグ支援の不足（Step 45 未完了）

- **NIF パニック時のトレース** — Rust 側で panic が発生すると BEAM VM ごとクラッシュ。スタックトレースが Elixir 側に出ない
- **panic_hook 未設定** — STEPS_MAP_SAVE_MULTI_DEBUG に記載の `init_panic_hook` が lib.rs に実装されていない
- **debug_dump_world 未実装** — 開発時にワールド状態を文字列で確認する NIF がない
- **RUST_LOG 統合** — Rust の log クレートと Elixir Logger の連携が未整備

**影響**: 2 言語をまたぐバグの切り分けに時間がかかる。開発効率のボトルネックになる可能性。

### 3.2 ビルド・開発環境の複雑さ

- **Elixir + Rust のデュアルビルド** — mix compile と cargo の両方が必要。初回ビルドが重い
- **音声アセットの事前生成** — Python スクリプト実行が前提。CI や新規参加者のオンボーディングが増える
- **2 言語習得コスト** — 参入障壁が高く、チーム開発には不向き

### 3.3 仕様との乖離

- **Skeleton, Ghost, Garlic 未実装** — SPEC に記載があるがゲームコンテンツとして未着手
- **Ghost の壁すり抜け** — 障害物システムは kind でスキップ可能な設計だが、Ghost 自体がないため検証されていない

### 3.4 エコシステム・ツール

- **Elixir × Rust ゲームの事例が少ない** — 参考にできる既存プロジェクトが限られる
- **エディタ・デバッガの統合** — Rust と Elixir の両方で快適にデバッグする環境構築が課題

### 3.5 マルチプレイの現状

- **44a は「並列セッション」** — 同一ワールド内の複数プレイヤー衝突判定は未対応（設計オプション B/C）
- **Phoenix Channels 連携** — 設計はあるが未実装。将来の拡張に依存

---

## 4. 技術的評価

### 4.1 コード品質

| 観点 | 評価 | コメント |
|------|------|----------|
| モジュール分離 | ◎ | Engine、Game、各システムの責務が明確 |
| テストカバレッジ | ○ | SpawnSystem、LevelSystem、BossSystem、Rust util/weapon 等にテストあり。E2E は不足 |
| エラーハンドリング | ○ | NifResult、rescue、:no_save 等のパターンあり。NIF 境界の統一は一部未達 |
| コメント・ドキュメント | ◎ | @moduledoc、@doc、Step 番号付きコメントが充実 |

### 4.2 パフォーマンス

- **フレーム予算** — 物理演算・描画が 16ms 以内に収まる設計。StressMonitor で監視可能
- **スケーリング** — 5000 体程度を想定。それ以上は SIMD 強化や GPU コンピュート検討
- **NIF オーバーヘッド** — get_frame_metadata で 1 回取得に集約済み。境界でのコピーは残るが許容範囲

### 4.3 セキュリティ・保守性

- **セーブデータ** — term_to_binary でローカル保存。改ざん検知なし。ローカル用途では問題なし
- **入力検証** — 敵数・座標等は Rust 側で制約。不正データの防御はおおむね妥当

---

## 5. プロジェクト運営面の評価

### 5.1 ロードマップの実行力

- **Step 1〜45 の大半を完了** — 計画された機能が順次実装されている
- **優先順位が明確** — PRIORITY_STEPS、NEXT_STEPS で何をすべきかが文書化されている
- **スコープ管理** — ELIXIR_RUST_DIVISION で「サポートしない」と判断した項目を明示。過剰な範囲拡大を防いでいる

### 5.2 改善提案

| 項目 | 提案 |
|------|------|
| Step 45 完了 | panic_hook、debug_dump_world、RUST_LOG を実装し、開発効率を上げる |
| E2E テスト | 起動〜ゲームオーバーまでの自動テストを CI に追加 |
| マルチプレイ検証 | 44b の前に、2 ルーム同時起動の動作確認を自動化 |
| SPEC 更新 | Skeleton/Ghost/Garlic を「将来実装」として明記するか、ロードマップに追加 |

---

## 6. 総合所見

### 6.1 現状の位置づけ

**「技術デモ」を超え、「実用に近いゲームエンジン」として成立している。**

- ヴァンパイアサバイバーライクのデモゲームが動作し、2 つ目のゲーム（MiniShooter）で汎用化が検証済み
- セーブ・ロード、マップ障害物、マルチルーム基盤まで整い、単一プロトタイプの域を脱している
- ドキュメントの質が高く、設計思想と実装が一致している

### 6.2 強く評価できる点

1. **アーキテクチャの一貫性** — Elixir と Rust の役割分担が設計から実装まで貫かれている
2. **段階的な汎用化** — ゲーム固有ロジックとエンジン層の分離が進んでいる
3. **パフォーマンスへの配慮** — SoA、空間ハッシュ、SIMD、RwLock 等の最適化が実装済み
4. **ドキュメント文化** — 判断の根拠が残り、後から参加する人も追いやすい

### 6.3 率直な課題

1. **デバッグ支援の遅れ** — Step 45 が未完のまま。NIF クラッシュ時のトレース改善は早急に対応したい
2. **2 言語の負荷** — 維持コストが高く、チームスケールには不利
3. **エコシステムの薄さ** — 同種のプロジェクトが少なく、情報収集に頼りにくい

### 6.4 一言まとめ

> **意図が明確で、設計と実装が噛み合った良質なプロジェクトである。**  
> Elixir の耐障害性・分散性と Rust のパフォーマンスを組み合わせるという方針が、コードとドキュメントの両方で体現されている。  
> 残る課題は主に**デバッグ支援の充実**と**仕様書との整合性整理**であり、アーキテクチャ上の根本的な問題ではない。

---

## 7. 将来の展望

### 7.1 ビジュアルエディタの計画

**将来、このゲームエンジン用のビジュアルエディタを開発する方針とする。**

| 想定する主な機能 | 内容 |
|------------------|------|
| マップ編集 | タイル・障害物の配置、配置のプレビュー |
| エンティティ配置 | スポーン位置、敵・アイテムの初期配置の編集 |
| ライブプレビュー | Elixir のホットリロードを活かし、編集結果を即時にゲーム画面へ反映 |
| GUI による編集 | コード編集に頼らず、ドラッグ＆ドロップ等で直感的に編集可能 |

本エンジンは Elixir のホットリロードと OTP による耐障害性を備えているため、ビジュアルエディタとゲームの連携により、**ライブデザイン**（編集しながら即座に結果を確認する開発体験）を実現できるポテンシャルがある。

実装優先度・技術選定については、現状のコア機能の安定化および汎用化基盤の整備を前提に、将来のロードマップで検討する。

---

## 関連ドキュメント

| ドキュメント | 用途 |
|-------------|------|
| [ENGINE_ANALYSIS_REVISED.md](./ENGINE_ANALYSIS_REVISED.md) | コードベース準拠の再評価（本評価のベース） |
| [ENGINE_STRENGTHS_WEAKNESSES.md](./ENGINE_STRENGTHS_WEAKNESSES.md) | 強み・弱みの詳細比較 |
| [STEPS_MAP_SAVE_MULTI_DEBUG.md](../05_steps/STEPS_MAP_SAVE_MULTI_DEBUG.md) | 完了したステップの元ドキュメント |
